import{a as E}from"./chunk-EH2XKO42.js";import"./chunk-X62LHEF6.js";import{a as Mt}from"./chunk-YK6OOJHV.js";import{$a as yt,A as lt,B as mt,Da as vt,Dc as It,E as H,Ec as Tt,G as dt,H as ut,K as ft,N as ht,Ob as Pt,S as bt,Ua as Ct,a as D,ab as gt,fb as wt,k as nt,l as at,lb as St,m as B,n as st,o as L,p as ct,qb as xt,y as pt,z as O}from"./chunk-AYDE6MWJ.js";import{$ as M,Ea as n,Fa as w,Hb as tt,Ka as z,Nb as u,Ob as f,Oc as q,Qa as J,Rc as _t,Sa as a,V as T,Wa as $,aa as j,ab as c,ac as et,bb as p,ca as C,cb as N,ga as W,gb as V,ha as F,jb as S,kb as x,mc as it,n as m,nb as K,oa as y,pa as g,rb as X,sb as Y,tb as Z,tc as ot,ub as A,vb as P,wb as R,xb as Q,xc as rt}from"./chunk-RFGELG3T.js";var I=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Point] Transaction Get";let o=e;return o})(),k=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Point] Credit";let o=e;return o})(),U=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Point] Debit";let o=e;return o})();var jt=(()=>{let e=class e{constructor(t){this.http=t}getUserTransaction(t){return this.http.get(`${D.URL}/points/consumer`,{params:t})}credit(t){return this.http.post(`${D.URL}/credit/points`,t)}debit(t){return this.http.post(`${D.URL}/debit/points`,t)}};e.\u0275fac=function(r){return new(r||e)(C(rt))},e.\u0275prov=M({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var d,l=(d=class{constructor(e,i){this.notificationService=e,this.pointService=i}static point(e){return e.point}getUserTransaction(e,{payload:i}){return this.pointService.getUserTransaction(i).pipe(T({next:t=>{e.patchState({point:{consumer_id:t?.consumer_id,balance:t?.balance,transactions:{data:t?.transactions?.data,total:t?.transactions?.total?t?.transactions?.total:t?.transactions?.data?.length}}})},error:t=>{throw e.patchState({point:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}),new Error(t?.error?.message)}}))}credit(e,i){return this.pointService.credit(i.payload).pipe(T({next:t=>{e.patchState({point:{consumer_id:t?.consumer_id,balance:t?.balance,transactions:{data:t?.transactions?.data,total:t?.transactions?.total?t?.transactions?.total:t?.transactions?.data?.length}}})},complete:()=>{this.notificationService.showSuccess("Balance Credited Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}debit(e,i){return this.pointService.debit(i.payload).pipe(T({next:t=>{e.patchState({point:{consumer_id:t?.consumer_id,balance:t?.balance,transactions:{data:t?.transactions?.data,total:t?.transactions?.total?t?.transactions?.total:t?.transactions?.data?.length}}})},complete:()=>{this.notificationService.showSuccess("Balance Debited Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}},d.\u0275fac=function(i){return new(i||d)(C(vt),C(jt))},d.\u0275prov=M({token:d,factory:d.\u0275fac}),d);m([B(I)],l.prototype,"getUserTransaction",null);m([B(k)],l.prototype,"credit",null);m([B(U)],l.prototype,"debit",null);m([ct()],l,"point",null);l=m([st({name:"point",defaults:{point:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}})],l);var Dt=["confirmationModal"],Bt=()=>[];function Et(o,e){if(o&1){let i=V();c(0,"app-button",18),S("click",function(){y(i);let r=x();return g(r.form.valid&&r.ConfirmationModal.openModal("credit"))}),P(1),u(2,"translate"),p()}if(o&2){let i=x();$("btn btn-animation"),a("disabled",!i.form.valid)("spinner",!1),n(),Q(" ",f(2,5,"add")," ")}}function kt(o,e){if(o&1){let i=V();c(0,"app-button",19),S("click",function(){y(i);let r=x(),h=A(22);return g((+r.balance<+h.value||!!h.value)&&r.ConfirmationModal.openModal("debit"))}),P(1),u(2,"translate"),p()}if(o&2){let i=x(),t=A(22);$("btn btn-outline"),a("spinner",!1)("disabled",+i.balance<+t.value||!t.value),n(),Q(" ",f(2,5,"withdraw")," ")}}var b=class b{constructor(e,i,t,r){this.document=e,this.renderer=i,this.store=t,this.formBuilder=r,this.balance=0,this.tableConfig={columns:[{title:"points",dataField:"amount"},{title:"type",dataField:"type_status"},{title:"remark",dataField:"detail"},{title:"created_at",dataField:"created_at",type:"date"}],data:[],total:0},this.store.dispatch(new Pt({role:"consumer",status:1})),this.form=this.formBuilder.group({consumer_id:new H("",[O.required]),balance:new H("",[O.required])}),this.form.controls.consumer_id.valueChanges.subscribe(h=>{h?(this.paginateInitialData.consumer_id=h,this.store.dispatch(new I(this.paginateInitialData)),this.point$.subscribe(s=>{let Nt=s?.transactions?.data?.filter(_=>(_.type_status=_.type?`<div class="status-${_.type}"><span>${_.type.replace(/_/g," ")}</span></div>`:"-",_));this.balance=s?s?.balance:0,this.tableConfig.data=s?Nt:[],this.tableConfig.total=s?s?.transactions?.total:0}),this.renderer.addClass(this.document.body,"loader-none")):(this.balance=0,this.tableConfig.data=[],this.tableConfig.total=0,this.form.controls.balance.reset())})}onTableChange(e){this.paginateInitialData=e;let i=this.form.controls.consumer_id?.value;this.paginateInitialData.consumer_id=i,i&&this.store.dispatch(new I(e))}submit(e){this.form.markAllAsTouched();let i=new k(this.form.value);e=="debit"&&(i=new U(this.form.value)),this.form.valid&&this.store.dispatch(i).subscribe({complete:()=>{this.form.controls.balance.reset()}})}ngOnDestroy(){this.renderer.removeClass(this.document.body,"loader-none")}};b.\u0275fac=function(i){return new(i||b)(w(et),w(z),w(nt),w(bt))},b.\u0275cmp=W({type:b,selectors:[["app-point"]],viewQuery:function(i,t){if(i&1&&X(Dt,5),i&2){let r;Y(r=Z())&&(t.ConfirmationModal=r.first)}},decls:31,vars:28,consts:[["bal",""],["confirmationModal",""],[1,"row","g-0"],[1,"col-xxl-4","col-xl-5"],[3,"formGroup"],[3,"gridClass","title"],["formControlName","consumer_id",1,"custom-select",3,"data","placeholder"],[1,"col-xxl-8","col-xl-7"],[1,"wallet-sec","theme-form"],[1,"wallet-amount"],[1,"wallet-icon"],[1,"ri-copper-diamond-line"],["type","number","formControlName","balance","numbersOnly","",1,"form-control",3,"placeholder"],[1,"btn-sec"],[3,"class","disabled","spinner","click",4,"hasPermission"],[3,"class","spinner","disabled","click",4,"hasPermission"],[3,"tableChanged","dateRange","tableConfig"],[3,"confirmed"],[3,"click","disabled","spinner"],[3,"click","spinner","disabled"]],template:function(i,t){if(i&1){let r=V();c(0,"div",2)(1,"div",3)(2,"form",4)(3,"app-page-wrapper",5),N(4,"select2",6),u(5,"async"),u(6,"async"),u(7,"translate"),p()()(),c(8,"div",7)(9,"form",4)(10,"app-page-wrapper",5)(11,"div",8)(12,"div",9)(13,"div",10),N(14,"i",11),p(),c(15,"div")(16,"h2"),P(17),p(),c(18,"h5"),P(19),u(20,"translate"),p()()(),N(21,"input",12,0),u(23,"translate"),c(24,"div",13),J(25,Et,3,7,"app-button",14)(26,kt,3,7,"app-button",15),p()()()()()(),c(27,"app-page-wrapper",5)(28,"app-table",16),S("tableChanged",function(s){return y(r),g(t.onTableChange(s))}),p()(),c(29,"app-confirmation-modal",17,1),S("confirmed",function(s){return y(r),g(t.submit(s==null?null:s.actionToPerform))}),p()}if(i&2){let r;n(2),a("formGroup",t.form),n(),a("gridClass","col-sm-12")("title","select_consumer"),n(),a("data",(r=f(5,17,t.users$))!=null&&r.length?f(6,19,t.users$):tt(27,Bt))("placeholder",f(7,21,"select_consumer")),n(5),a("formGroup",t.form),n(),a("gridClass","col-sm-12")("title","point"),n(7),R(t.balance==null?null:t.balance.toFixed(2)),n(2),R(f(20,23,"point_balance")),n(2),K("placeholder",f(23,25,"add_withdraw_amount")),n(4),a("hasPermission","point.credit"),n(),a("hasPermission","point.debit"),n(),a("gridClass","col-sm-12")("title","transactions"),n(),a("dateRange",!0)("tableConfig",t.tableConfig)}},dependencies:[dt,pt,ut,lt,mt,ft,ht,wt,xt,St,Ct,yt,It,gt,it,_t]});var v=b;m([L(E.users)],v.prototype,"users$",void 0);m([L(l.point)],v.prototype,"point$",void 0);var Ut=[{path:"",component:v,canActivate:[Mt],data:{permission:"point.index"}}],Ft=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=F({type:e}),e.\u0275inj=j({imports:[q.forChild(Ut),q]});let o=e;return o})();var Pe=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=F({type:e}),e.\u0275inj=j({imports:[ot,Ft,Tt,at.forFeature([E,l])]});let o=e;return o})();export{Pe as PointModule};
