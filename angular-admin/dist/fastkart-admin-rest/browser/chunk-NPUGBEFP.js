import{a as z}from"./chunk-Q3KTT2IO.js";import{a as H}from"./chunk-YK6OOJHV.js";import{A as Ee,B as Te,Da as Be,E as I,Ec as Ve,G as je,K as Ae,N as Me,S as $e,Ua as Pe,Yb as ae,a as g,fb as Ue,k,l as ke,lb as x,m as S,n as Ie,o as O,p as se,qb as Ne,rb as Re,x as xe,y as Fe,z as W}from"./chunk-AYDE6MWJ.js";import{$ as N,Ca as ue,Ea as n,F as le,Fa as y,Hb as oe,Jc as be,Ka as fe,Lc as G,Nb as u,Ob as f,Oc as ne,Qa as B,Rb as _e,Rc as De,S as de,Sa as a,T as me,V as K,Wa as ye,a as j,aa as R,ab as c,ac as ge,b as A,bb as p,ca as L,cb as h,ga as _,gb as he,ha as V,i as re,jb as D,jc as Se,mc as Ce,n as m,nb as q,oa as M,p as ce,pa as $,tc as we,u as pe,ub as ve,vb as b,wb as Ke,xb as P,xc as Le}from"./chunk-RFGELG3T.js";var F=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[LicenseKey] Get";let i=e;return i})(),J=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[LicenseKey] Create";let i=e;return i})(),Q=(()=>{let e=class e{constructor(t){this.id=t}};e.type="[LicenseKey] Edit";let i=e;return i})(),X=(()=>{let e=class e{constructor(t,r){this.payload=t,this.id=r}};e.type="[LicenseKey] Update";let i=e;return i})(),Y=(()=>{let e=class e{constructor(t,r){this.id=t,this.status=r}};e.type="[LicenseKey] Update Status";let i=e;return i})(),Z=(()=>{let e=class e{constructor(t){this.id=t}};e.type="[LicenseKey] Delete";let i=e;return i})(),ee=(()=>{let e=class e{constructor(t){this.ids=t}};e.type="[LicenseKey] Delete All";let i=e;return i})();var qe=(()=>{let e=class e{constructor(t){this.http=t}getLicenseKeys(t){return this.http.get(`${g.URL}/license-key`,{params:t})}createLicenseKey(t){return this.http.post(`${g.URL}/license-key`,t)}editLicenseKey(t){return this.http.get(`${g.URL}/license-key/${t}`)}updateLicenseKey(t,r){return this.http.put(`${g.URL}/license-key/${t}`,r)}updateLicenseKeyStatus(t,r){return this.http.put(`${g.URL}/license-key/${t}/${r}`,{})}deleteLicenseKey(t){return this.http.delete(`${g.URL}/license-key/${t}`)}deleteAllLicenseKey(t){return this.http.post(`${g.URL}/license-key/deleteAll`,{ids:t})}};e.\u0275fac=function(r){return new(r||e)(L(Le))},e.\u0275prov=N({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var v,l=(v=class{constructor(e,o,t){this.store=e,this.notificationService=o,this.licenseKeyServiceService=t}static licenseKey(e){return e.licenseKey}static selectedLicenseKey(e){return e.selectedLicenseKey}getLicenseKeys(e,o){return this.licenseKeyServiceService.getLicenseKeys(o.payload).pipe(K({next:t=>{e.patchState({licenseKey:{data:t.data,total:t?.total?t?.total:t.data?.length}})},error:t=>{throw new Error(t?.error?.message)}}))}create(e,o){return this.licenseKeyServiceService.createLicenseKey(o.payload).pipe(K({next:t=>{let r=e.getState();e.patchState(A(j({},r),{licenseKey:{data:[...r.licenseKey.data,t],total:r?.licenseKey.total+1}}))},complete:()=>{this.notificationService.showSuccess("License Created Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}edit(e,{id:o}){return this.licenseKeyServiceService.editLicenseKey(o).pipe(K({next:t=>{let r=e.getState();e.patchState(A(j({},r),{selectedLicenseKey:t}))},error:t=>{throw new Error(t?.error?.message)}}))}update(e,{payload:o,id:t}){return this.licenseKeyServiceService.updateLicenseKey(t,o).pipe(K({next:r=>{if(typeof r=="object"){let s=e.getState(),d=[...s.licenseKey.data],te=d.findIndex(ie=>ie.id===t);d[te]=r,e.patchState(A(j({},s),{licenseKey:{data:d,total:s.licenseKey.total}}))}},complete:()=>{this.notificationService.showSuccess("License Key Updated Successfully")},error:r=>{throw new Error(r?.error?.message)}}))}updateStatus(e,{id:o,status:t}){return this.licenseKeyServiceService.updateLicenseKeyStatus(o,t).pipe(K({next:r=>{if(typeof r=="object"){let s=e.getState(),d=[...s.licenseKey.data],te=d.findIndex(ie=>ie.id===o);d[te]=r,e.patchState(A(j({},s),{licenseKey:{data:d,total:s.licenseKey.total}}))}},complete:()=>{this.notificationService.showSuccess("License Key Status Updated Successfully")},error:r=>{throw new Error(r?.error?.message)}}))}delete(e,{id:o}){return this.licenseKeyServiceService.deleteLicenseKey(o).pipe(K({next:()=>{this.store.dispatch(new F({page:1,paginate:15}))},complete:()=>{this.notificationService.showSuccess("License Key Deleted Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}deleteAll(e,{ids:o}){return this.licenseKeyServiceService.deleteAllLicenseKey(o).pipe(K({next:()=>{this.store.dispatch(new F({page:1,paginate:15}))},complete:()=>{this.notificationService.showSuccess("License Key Deleted Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}},v.\u0275fac=function(o){return new(o||v)(L(k),L(Be),L(qe))},v.\u0275prov=N({token:v,factory:v.\u0275fac}),v);m([S(F)],l.prototype,"getLicenseKeys",null);m([S(J)],l.prototype,"create",null);m([S(Q)],l.prototype,"edit",null);m([S(X)],l.prototype,"update",null);m([S(Y)],l.prototype,"updateStatus",null);m([S(Z)],l.prototype,"delete",null);m([S(ee)],l.prototype,"deleteAll",null);m([se()],l,"licenseKey",null);m([se()],l,"selectedLicenseKey",null);l=m([Ie({name:"licenseKey",defaults:{licenseKey:{data:[],total:0},selectedLicenseKey:null}})],l);var E=class E{constructor(e,o){this.store=e,this.router=o,this.tableConfig={columns:[{title:"product",dataField:"item_name"},{title:"license_key",dataField:"license_key",sortable:!0,sort_direction:"desc"},{title:"purchased_by",dataField:"purchased_by.name"},{title:"created_at",dataField:"created_at",type:"date",sortable:!0,sort_direction:"desc"}],data:[],total:0}}ngOnInit(){this.licenseKey$.subscribe(e=>{this.tableConfig.data=e?e?.data:[],this.tableConfig.total=e?e?.total:0})}onTableChange(e){this.store.dispatch(new F(e))}onActionClicked(e){e.actionToPerform=="edit"?this.edit(e.data):e.actionToPerform=="status"?this.status(e.data):e.actionToPerform=="delete"?this.delete(e.data):e.actionToPerform=="deleteAll"&&this.deleteAll(e.data)}edit(e){this.router.navigateByUrl(`/license-key/edit/${e.id}`)}status(e){this.store.dispatch(new Y(e.id,e.status))}delete(e){this.store.dispatch(new Z(e.id))}deleteAll(e){this.store.dispatch(new ee(e))}};E.\u0275fac=function(o){return new(o||E)(y(k),y(G))},E.\u0275cmp=_({type:E,selectors:[["app-license-key"]],decls:2,vars:4,consts:[[3,"gridClass","title"],[3,"tableChanged","rowClicked","action","tableConfig","hasCheckbox"]],template:function(o,t){o&1&&(c(0,"app-page-wrapper",0)(1,"app-table",1),D("tableChanged",function(s){return t.onTableChange(s)})("rowClicked",function(s){return t.edit(s)})("action",function(s){return t.onActionClicked(s)}),p()()),o&2&&(a("gridClass","col-sm-12")("title","License Key"),n(),a("tableConfig",t.tableConfig)("hasCheckbox",!0))},dependencies:[Ne,x]});var U=E;m([O(l.licenseKey)],U.prototype,"licenseKey$",void 0);var We=()=>[];function Ze(i,e){i&1&&(c(0,"div",12),b(1),u(2,"translate"),p()),i&2&&(n(),P(" ",f(2,1,"license_key_is_required")," "))}function et(i,e){i&1&&(c(0,"div",12),b(1),u(2,"translate"),p()),i&2&&(n(),P(" ",f(2,1,"separator_is_required")," "))}function tt(i,e){if(i&1&&(c(0,"div",13),h(1,"img",14),p(),b(2)),i&2){let o=e.data;n(),ye("img-fluid selection-image"),a("src",o.image,ue),n(),P(" ",o.name," ")}}function it(i,e){i&1&&(c(0,"div",12),b(1),u(2,"translate"),p()),i&2&&(n(),P(" ",f(2,1,"product_is_required")," "))}var T=class T{constructor(e,o,t,r,s,d){this.store=e,this.router=o,this.route=t,this.formBuilder=r,this.renderer=s,this.document=d,this.search=new re,this.destroy$=new re,this.separators=[{value:"comma",label:"Comma ( , )"},{value:"semicolon",label:"Semicolon ( ; )"},{value:"pipe",label:"Pipe ( | )"},{value:"newline",label:"Newline"}],this.form=this.formBuilder.group({license_key:new I("",[W.required]),separator:new I("",[W.required]),product_id:new I("",[W.required]),variation_id:new I(""),status:new I(1)})}ngOnInit(){this.store.dispatch(new ae({status:1,is_approved:1,paginate:15})),this.route.params.pipe(de(e=>e.id?this.store.dispatch(new Q(e.id)).pipe(pe(()=>this.store.select(l.selectedLicenseKey))):ce()),me(this.destroy$)).subscribe(e=>{this.licenseKey=e,this.form.patchValue({license_key:this.licenseKey?.license_key,separator:this.licenseKey?.separator,product_id:this.licenseKey?.product_id,variation_id:this.licenseKey?.variation_id,status:this.licenseKey?.status})}),this.search.pipe(le(300)).subscribe(e=>{this.store.dispatch(new ae({status:1,is_approved:1,paginate:15,search:e})),this.renderer.addClass(this.document.body,"loader-none")})}productDropdown(e){e.innerSearchText&&this.search.next("")}searchProduct(e){this.search.next(e.search)}updateProduct(e){e&&e.options.length&&e.options[0].data&&(this.form.controls.product_id.setValue(e.options[0].data.product_id),this.form.controls.variation_id.setValue(e.options[0].data.variation_id?e.options[0].data.variation_id:null))}submit(){this.form.markAllAsTouched();let e=new J(this.form.value);this.type=="edit"&&this.licenseKey?.id&&(e=new X(this.form.value,this.licenseKey.id)),this.form.valid&&this.store.dispatch(e).subscribe({complete:()=>{this.router.navigateByUrl("/license-key")}})}};T.\u0275fac=function(o){return new(o||T)(y(k),y(G),y(be),y($e),y(fe),y(ge))},T.\u0275cmp=_({type:T,selectors:[["app-form-license-key"]],inputs:{type:"type"},decls:29,vars:49,consts:[["template",""],[1,"theme-form","theme-form-2","mega-form",3,"ngSubmit","formGroup"],[3,"label","for","required"],["formControlName","license_key","rows","3",1,"form-control",3,"placeholder"],["class","invalid-feedback",4,"ngIf"],["formControlName","separator",1,"custom-select","d-block",3,"data","placeholder","noResultMessage"],[1,"custom-select",3,"update","close","search","templates","data","placeholder","customSearchEnabled","noResultMessage"],[1,"form-check","form-switch","ps-0"],[1,"switch"],["type","checkbox","id","status","formControlName","status"],[1,"switch-state"],[3,"id"],[1,"invalid-feedback"],[1,"image"],[3,"src"]],template:function(o,t){if(o&1){let r=he();c(0,"form",1),D("ngSubmit",function(){return M(r),$(t.submit())}),c(1,"app-form-fields",2),u(2,"translate"),h(3,"textarea",3),u(4,"translate"),B(5,Ze,3,3,"div",4),p(),c(6,"app-form-fields",2),h(7,"select2",5),u(8,"translate"),u(9,"translate"),B(10,et,3,3,"div",4),p(),c(11,"app-form-fields",2)(12,"select2",6),u(13,"translate"),u(14,"async"),u(15,"async"),u(16,"translate"),D("update",function(d){return M(r),$(t.updateProduct(d))})("close",function(d){return M(r),$(t.productDropdown(d))})("search",function(d){return M(r),$(t.searchProduct(d))}),B(17,tt,3,4,"ng-template",null,0,_e),p(),B(19,it,3,3,"div",4),p(),c(20,"app-form-fields",2),u(21,"translate"),c(22,"div",7)(23,"label",8),h(24,"input",9)(25,"span",10),p()()(),c(26,"app-button",11),b(27),u(28,"translate"),p()()}if(o&2){let r,s=ve(18);a("formGroup",t.form),n(),a("label",f(2,27,"license_key"))("for","license_key")("required",!0),n(2),q("placeholder",f(4,29,"enter_license_key")),n(2),a("ngIf",t.form.controls.license_key.touched&&(t.form.controls.license_key.errors==null?null:t.form.controls.license_key.errors.required)),n(),a("label","separator")("for","separator")("required",!0),n(),q("noResultMessage",f(8,31,"no_data_found")),a("data",t.separators.length?t.separators:oe(47,We))("placeholder",f(9,33,"select_separator")),n(3),a("ngIf",t.form.controls.separator.touched&&(t.form.controls.separator.errors==null?null:t.form.controls.separator.errors.required)),n(),a("label","product")("for","product")("required",!0),n(),q("noResultMessage",f(13,35,"no_data_found")),a("templates",s)("data",(r=f(14,37,t.product$))!=null&&r.length?f(15,39,t.product$):oe(48,We))("placeholder",f(16,41,"select_product"))("customSearchEnabled",!0),n(7),a("ngIf",t.form.controls.product_id.touched&&(t.form.controls.product_id.errors==null?null:t.form.controls.product_id.errors.required)),n(),a("label",f(21,43,"status"))("for","status")("required",!1),n(6),a("id","key_btn"),n(),Ke(f(28,45,t.type=="create"?"save_key":"update_key"))}},dependencies:[Se,je,Fe,xe,Ee,Te,Ae,Me,Ue,Re,Pe,Ce,De]});var w=T;m([O(z.digitalProducts)],w.prototype,"product$",void 0);var He=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=_({type:e,selectors:[["app-create-license-key"]],decls:2,vars:2,consts:[[3,"title"],[3,"type"]],template:function(r,s){r&1&&(c(0,"app-page-wrapper",0),h(1,"app-form-license-key",1),p()),r&2&&(a("title","create_key"),n(),a("type","create"))},dependencies:[x,w]});let i=e;return i})();var Je=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=_({type:e,selectors:[["app-edit-license-key"]],decls:2,vars:2,consts:[[3,"title"],[3,"type"]],template:function(r,s){r&1&&(c(0,"app-page-wrapper",0),h(1,"app-form-license-key",1),p()),r&2&&(a("title","edit_key"),n(),a("type","edit"))},dependencies:[x,w]});let i=e;return i})();var rt=[{path:"",component:U,canActivate:[H],data:{permission:"license_key.index"}},{path:"create",component:He,canActivate:[H],data:{permission:["license_key.index","license_key.create"]}},{path:"edit/:id",component:Je,canActivate:[H],data:{permission:["license_key.index","license_key.edit"]}}],Qe=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=V({type:e}),e.\u0275inj=R({imports:[ne.forChild(rt),ne]});let i=e;return i})();var oi=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=V({type:e}),e.\u0275inj=R({imports:[we,Qe,Ve,ke.forFeature([z,l])]});let i=e;return i})();export{oi as LicenseKeyModule};
