import{a as U}from"./chunk-EH2XKO42.js";import"./chunk-X62LHEF6.js";import{a as Vt}from"./chunk-YK6OOJHV.js";import{$a as gt,A as mt,B as dt,Da as yt,Dc as jt,E as z,Ec as Nt,G as ut,H as ft,K as ht,N as bt,Oa as k,Ob as Mt,S as wt,Ua as vt,a as F,ab as Ct,fb as St,k as nt,l as st,lb as xt,m as E,n as lt,o as W,p as ct,pb as It,qb as Tt,y as pt,z as H}from"./chunk-AYDE6MWJ.js";import{$ as j,Ea as o,Fa as C,Hb as et,Ka as K,Nb as m,Ob as d,Oc as O,Qa as X,Rc as _t,Sa as n,V as M,Wa as R,aa as N,ab as c,ac as it,bb as p,ca as _,cb as B,ga as J,gb as D,ha as V,jb as S,kb as x,mc as at,n as l,nb as A,oa as v,pa as g,rb as Y,sb as Z,tb as tt,tc as rt,ub as Q,vb as I,wb as q,xb as L,xc as ot}from"./chunk-RFGELG3T.js";var T=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Wallet] Transaction Get";let a=e;return a})(),P=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Wallet] Credit";let a=e;return a})(),$=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Wallet] Debit";let a=e;return a})();var Bt=(()=>{let e=class e{constructor(t){this.http=t}getUserTransaction(t){return this.http.get(`${F.URL}/wallet/consumer`,{params:t})}credit(t){return this.http.post(`${F.URL}/credit/wallet`,t)}debit(t){return this.http.post(`${F.URL}/debit/wallet`,t)}};e.\u0275fac=function(r){return new(r||e)(_(ot))},e.\u0275prov=j({token:e,factory:e.\u0275fac,providedIn:"root"});let a=e;return a})();var f,u=(f=class{constructor(e,i){this.notificationService=e,this.walletService=i}static wallet(e){return e.wallet}getUserTransations(e,{payload:i}){return this.walletService.getUserTransaction(i).pipe(M({next:t=>{e.patchState({wallet:{consumer_id:t?.consumer_id,balance:t?.balance,transactions:{data:t?.transactions?.data,total:t?.transactions?.total?t?.transactions?.total:t?.transactions?.data?.length}}})},error:t=>{throw e.patchState({wallet:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}),new Error(t?.error?.message)}}))}credit(e,i){return this.walletService.credit(i.payload).pipe(M({next:t=>{e.patchState({wallet:{consumer_id:t?.consumer_id,balance:t?.balance,transactions:{data:t?.transactions?.data,total:t?.transactions?.total?t?.transactions?.total:t?.transactions?.data?.length}}})},complete:()=>{this.notificationService.showSuccess("Balance Credited Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}debit(e,i){return this.walletService.debit(i.payload).pipe(M({next:t=>{e.patchState({wallet:{consumer_id:t?.consumer_id,balance:t?.balance,transactions:{data:t?.transactions?.data,total:t?.transactions?.total?t?.transactions?.total:t?.transactions?.data?.length}}})},complete:()=>{this.notificationService.showSuccess("Balance Debited Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}},f.\u0275fac=function(i){return new(i||f)(_(yt),_(Bt))},f.\u0275prov=j({token:f,factory:f.\u0275fac}),f);l([E(T)],u.prototype,"getUserTransations",null);l([E(P)],u.prototype,"credit",null);l([E($)],u.prototype,"debit",null);l([ct()],u,"wallet",null);u=l([lt({name:"wallet",defaults:{wallet:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}})],u);var Wt=["confirmationModal"],kt=()=>[];function Ut(a,e){if(a&1){let i=D();c(0,"app-button",18),S("click",function(){v(i);let r=x();return g(r.form.valid&&r.ConfirmationModal.openModal("credit"))}),I(1),m(2,"translate"),p()}if(a&2){let i=x();R("btn btn-animation"),n("disabled",!i.form.valid)("spinner",!1),o(),L(" ",d(2,5,"add")," ")}}function Pt(a,e){if(a&1){let i=D();c(0,"app-button",19),S("click",function(){v(i);let r=x(),h=Q(24);return g(+r.balance<+h.value||!!h.value&&r.ConfirmationModal.openModal("debit"))}),I(1),m(2,"translate"),p()}if(a&2){let i=x(),t=Q(24);R("btn btn-outline"),n("spinner",!1)("disabled",+i.balance<+t.value||!t.value),o(),L(" ",d(2,5,"withdraw")," ")}}var w=class w{constructor(e,i,t,r){this.document=e,this.renderer=i,this.store=t,this.formBuilder=r,this.balance=0,this.tableConfig={columns:[{title:"amount",dataField:"amount",type:"price"},{title:"type",dataField:"type_status"},{title:"remark",dataField:"detail"},{title:"created_at",dataField:"created_at",type:"date"}],data:[],total:0},this.store.dispatch(new Mt({role:"consumer",status:1})),this.form=this.formBuilder.group({consumer_id:new z("",[H.required]),balance:new z("",[H.required])}),this.form.controls.consumer_id.valueChanges.subscribe(h=>{h?(this.paginateInitialData.consumer_id=h,this.store.dispatch(new T(this.paginateInitialData)),this.wallet$.subscribe(s=>{let Ft=s?.transactions?.data?.filter(y=>(y.type_status=y.type?`<div class="status-${y.type}"><span>${y.type.replace(/_/g," ")}</span></div>`:"-",y));this.balance=s?s?.balance:0,this.tableConfig.data=s?Ft:[],this.tableConfig.total=s?s?.transactions?.total:0}),this.renderer.addClass(this.document.body,"loader-none")):(this.balance=0,this.tableConfig.data=[],this.tableConfig.total=0,this.form.controls.balance.reset())})}onTableChange(e){this.paginateInitialData=e;let i=this.form.controls.consumer_id?.value;this.paginateInitialData.consumer_id=i,i&&this.store.dispatch(new T(e))}submit(e){this.form.markAllAsTouched();let i=new P(this.form.value);e=="debit"&&(i=new $(this.form.value)),this.form.valid&&this.store.dispatch(i).subscribe({complete:()=>{this.form.controls.balance.reset()}})}ngOnDestroy(){this.renderer.removeClass(this.document.body,"loader-none")}};w.\u0275fac=function(i){return new(i||w)(C(it),C(K),C(nt),C(wt))},w.\u0275cmp=J({type:w,selectors:[["app-wallet"]],viewQuery:function(i,t){if(i&1&&Y(Wt,5),i&2){let r;Z(r=tt())&&(t.ConfirmationModal=r.first)}},decls:33,vars:33,consts:[["bal",""],["confirmationModal",""],[1,"row","g-0"],[1,"col-xxl-4","col-xl-5"],[3,"formGroup"],[3,"gridClass","title"],["formControlName","consumer_id",1,"custom-select",3,"data","placeholder","noResultMessage"],[1,"col-xxl-8","col-xl-7"],[1,"wallet-sec","theme-form"],[1,"wallet-amount"],[1,"wallet-icon"],[1,"ri-wallet-line"],["type","number","formControlName","balance","numbersOnly","",1,"form-control",3,"placeholder"],[1,"btn-sec"],[3,"class","disabled","spinner","click",4,"hasPermission"],[3,"class","spinner","disabled","click",4,"hasPermission"],[3,"tableChanged","dateRange","tableConfig"],[3,"confirmed"],[3,"click","disabled","spinner"],[3,"click","spinner","disabled"]],template:function(i,t){if(i&1){let r=D();c(0,"div",2)(1,"div",3)(2,"form",4)(3,"app-page-wrapper",5),B(4,"select2",6),m(5,"translate"),m(6,"async"),m(7,"async"),m(8,"translate"),p()()(),c(9,"div",7)(10,"form",4)(11,"app-page-wrapper",5)(12,"div",8)(13,"div",9)(14,"div",10),B(15,"i",11),p(),c(16,"div")(17,"h2"),I(18),m(19,"currencySymbol"),p(),c(20,"h5"),I(21),m(22,"translate"),p()()(),B(23,"input",12,0),m(25,"translate"),c(26,"div",13),X(27,Ut,3,7,"app-button",14)(28,Pt,3,7,"app-button",15),p()()()()()(),c(29,"app-page-wrapper",5)(30,"app-table",16),S("tableChanged",function(s){return v(r),g(t.onTableChange(s))}),p()(),c(31,"app-confirmation-modal",17,1),S("confirmed",function(s){return v(r),g(t.submit(s==null?null:s.actionToPerform))}),p()}if(i&2){let r;o(2),n("formGroup",t.form),o(),n("gridClass","col-sm-12")("title","select_consumer"),o(),A("noResultMessage",d(5,18,"no_data_found")),n("data",(r=d(6,20,t.users$))!=null&&r.length?d(7,22,t.users$):et(32,kt))("placeholder",d(8,24,"select_consumer")),o(6),n("formGroup",t.form),o(),n("gridClass","col-sm-12")("title","wallet"),o(7),q(d(19,26,t.balance)),o(3),q(d(22,28,"wallet_balance")),o(2),A("placeholder",d(25,30,"add_withdraw_amount")),o(4),n("hasPermission","wallet.credit"),o(),n("hasPermission","wallet.debit"),o(),n("gridClass","col-sm-12")("title","transactions"),o(),n("dateRange",!0)("tableConfig",t.tableConfig)}},dependencies:[ut,pt,ft,mt,dt,ht,bt,St,Tt,xt,vt,gt,jt,Ct,at,_t,It]});var b=w;l([W(U.users)],b.prototype,"users$",void 0);l([W(u.wallet)],b.prototype,"wallet$",void 0);l([W(k.setting)],b.prototype,"setting$",void 0);var $t=[{path:"",component:b,canActivate:[Vt],data:{permission:"wallet.index"}}],Dt=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=V({type:e}),e.\u0275inj=N({imports:[O.forChild($t),O]});let a=e;return a})();var Ve=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=V({type:e}),e.\u0275inj=N({imports:[rt,Dt,Nt,st.forFeature([U,u,k])]});let a=e;return a})();export{Ve as WalletModule};
